language: cpp

os:
  - linux
  - osx

script:
  - export TOP=$(pwd)
  - git clone --branch fix-macos https://github.com/KhronosGroup/OpenCL-Headers.git
  - cd OpenCL-Headers
  - ln -s CL OpenCL # for macOS builds
  - cd ..
  - git clone --branch fix-macos https://github.com/KhronosGroup/OpenCL-ICD-Loader.git
  - cd ${TOP}/OpenCL-ICD-Loader
  - mkdir build
  - cd build
  - cmake -DOPENCL_INCLUDE_DIRS=${TOP}/OpenCL-Headers/ ..
  - make
  - cd ${TOP}
  - ls -l
  - mkdir build
  - cd build
  - cmake -DCL_INCLUDE_DIR=${TOP}/OpenCL-Headers
          -DCL_LIB_DIR=${TOP}/OpenCL-ICD-Loader/build/lib
          -DCMAKE_RUNTIME_OUTPUT_DIRECTORY=./bin
          -DOPENCL_LIBRARIES="-lOpenCL -lpthread"
          ..
  - make -j2
